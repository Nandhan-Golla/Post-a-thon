{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/Post-a-thon/app/api/issue-cert/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nconst CERTIFIER_BASE_URL = \"https://api.certifier.io/v1/credentials\"\r\nconst CERTIFIER_VERSION = \"2022-10-26\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const certifierApiKey = \"cfp_omIat4JPukFSP2AEz2Bld5ME1gKHTVQN2uEM\"\r\n\r\n    if (!certifierApiKey) {\r\n      console.error(\"[certifier] Missing CERTIFIER_API_KEY\")\r\n      return NextResponse.json(\r\n        { error: \"Server configuration error\" },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    const headers = {\r\n      accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n      \"Certifier-Version\": CERTIFIER_VERSION,\r\n      Authorization: `Bearer ${certifierApiKey}`,\r\n    }\r\n\r\n    /* --------------------------------------------------\r\n       1. LIST CREDENTIALS (GET IDs)\r\n    -------------------------------------------------- */\r\n    const listRes = await fetch(\r\n      `${CERTIFIER_BASE_URL}?limit=20`,\r\n      { headers }\r\n    )\r\n\r\n    if (!listRes.ok) {\r\n      const err = await listRes.text()\r\n      console.error(\"[certifier] Failed to list credentials:\", err)\r\n      return NextResponse.json(\r\n        { error: \"Failed to fetch credentials\" },\r\n        { status: listRes.status }\r\n      )\r\n    }\r\n\r\n    const listData = await listRes.json()\r\n\r\n    const credentialIds: string[] =\r\n      listData?.data?.map((c: any) => c.id) ?? []\r\n\r\n    if (credentialIds.length === 0) {\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: \"No credentials found to send\",\r\n        sent: 0,\r\n      })\r\n    }\r\n\r\n    /* --------------------------------------------------\r\n       2. SEND EACH CREDENTIAL\r\n    -------------------------------------------------- */\r\n    let sentCount = 0\r\n    const failures: { id: string; error: string }[] = []\r\n\r\n    for (const id of credentialIds) {\r\n      try {\r\n        const sendRes = await fetch(\r\n          `${CERTIFIER_BASE_URL}/${id}/send`,\r\n          {\r\n            method: \"POST\",\r\n            headers,\r\n            body: JSON.stringify({\r\n              deliveryMethod: \"email\"\r\n            }),\r\n          }\r\n        )\r\n\r\n        if (!sendRes.ok) {\r\n          const err = await sendRes.text()\r\n          failures.push({ id, error: err })\r\n          continue\r\n        }\r\n\r\n        sentCount++\r\n\r\n        // Optional small delay to avoid rate limits\r\n        await new Promise(r => setTimeout(r, 150))\r\n\r\n      } catch (err: any) {\r\n        failures.push({ id, error: err.message })\r\n      }\r\n    }\r\n\r\n    /* --------------------------------------------------\r\n       3. RESPONSE\r\n    -------------------------------------------------- */\r\n    return NextResponse.json({\r\n      success: true,\r\n      total: credentialIds.length,\r\n      sent: sentCount,\r\n      failed: failures.length,\r\n      failures,\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error(\"[certifier] Unexpected error:\", error)\r\n    return NextResponse.json(\r\n      { error: \"Internal server error\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,qBAAqB;AAC3B,MAAM,oBAAoB;AAEnB,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,kBAAkB;QAExB;;QAQA,MAAM,UAAU;YACd,QAAQ;YACR,gBAAgB;YAChB,qBAAqB;YACrB,eAAe,CAAC,OAAO,EAAE,iBAAiB;QAC5C;QAEA;;uDAEmD,GACnD,MAAM,UAAU,MAAM,MACpB,GAAG,mBAAmB,SAAS,CAAC,EAChC;YAAE;QAAQ;QAGZ,IAAI,CAAC,QAAQ,EAAE,EAAE;YACf,MAAM,MAAM,MAAM,QAAQ,IAAI;YAC9B,QAAQ,KAAK,CAAC,2CAA2C;YACzD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ,QAAQ,MAAM;YAAC;QAE7B;QAEA,MAAM,WAAW,MAAM,QAAQ,IAAI;QAEnC,MAAM,gBACJ,UAAU,MAAM,IAAI,CAAC,IAAW,EAAE,EAAE,KAAK,EAAE;QAE7C,IAAI,cAAc,MAAM,KAAK,GAAG;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,SAAS;gBACT,MAAM;YACR;QACF;QAEA;;uDAEmD,GACnD,IAAI,YAAY;QAChB,MAAM,WAA4C,EAAE;QAEpD,KAAK,MAAM,MAAM,cAAe;YAC9B,IAAI;gBACF,MAAM,UAAU,MAAM,MACpB,GAAG,mBAAmB,CAAC,EAAE,GAAG,KAAK,CAAC,EAClC;oBACE,QAAQ;oBACR;oBACA,MAAM,KAAK,SAAS,CAAC;wBACnB,gBAAgB;oBAClB;gBACF;gBAGF,IAAI,CAAC,QAAQ,EAAE,EAAE;oBACf,MAAM,MAAM,MAAM,QAAQ,IAAI;oBAC9B,SAAS,IAAI,CAAC;wBAAE;wBAAI,OAAO;oBAAI;oBAC/B;gBACF;gBAEA;gBAEA,4CAA4C;gBAC5C,MAAM,IAAI,QAAQ,CAAA,IAAK,WAAW,GAAG;YAEvC,EAAE,OAAO,KAAU;gBACjB,SAAS,IAAI,CAAC;oBAAE;oBAAI,OAAO,IAAI,OAAO;gBAAC;YACzC;QACF;QAEA;;uDAEmD,GACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO,cAAc,MAAM;YAC3B,MAAM;YACN,QAAQ,SAAS,MAAM;YACvB;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}